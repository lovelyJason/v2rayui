<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>v2rayui - 连接配置</title>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <link rel="stylesheet" href="/static/css/mdui.min.css">
  <style>
    .mdui-container {
      height: calc(100vh - 120px);
    }

    .mdui-row,
    .mdui-row .mdui-table-fluid {
      height: 100%;
    }

    @media (min-width: 1024px) {
      .mdui-col-md-1 {
        width: auto;
      }
    }
  </style>
  <script src="/static/js/mdui.min.js"></script>
</head>

<body
  class="mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-light-blue mdui-loaded mdui-drawer-body-left">

  <header class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
      <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
        mdui-drawer="{target: '#main-drawer', swipe: true}">
        <i class="mdui-icon material-icons">menu</i></span>
      <a href="./" class="mdui-typo-headline mdui-hidden-xs">v2rayui</a>
      <a href="" class="mdui-typo-title">连接配置</a>
      <div class="mdui-toolbar-spacer"></div>
      <a href="https://github.com/FunctionClub/" target="_blank"
        class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white" mdui-tooltip="{content: 'Github'}">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px" y="0px" viewBox="0 0 36 36" enable-background="new 0 0 36 36" xml:space="preserve" class="mdui-icon"
          style="width: 24px;height:24px;">
          <path fill-rule="evenodd" clip-rule="evenodd" fill="#ffffff" d="M18,1.4C9,1.4,1.7,8.7,1.7,17.7c0,7.2,4.7,13.3,11.1,15.5
	c0.8,0.1,1.1-0.4,1.1-0.8c0-0.4,0-1.4,0-2.8c-4.5,1-5.5-2.2-5.5-2.2c-0.7-1.9-1.8-2.4-1.8-2.4c-1.5-1,0.1-1,0.1-1
	c1.6,0.1,2.5,1.7,2.5,1.7c1.5,2.5,3.8,1.8,4.7,1.4c0.1-1.1,0.6-1.8,1-2.2c-3.6-0.4-7.4-1.8-7.4-8.1c0-1.8,0.6-3.2,1.7-4.4
	c-0.2-0.4-0.7-2.1,0.2-4.3c0,0,1.4-0.4,4.5,1.7c1.3-0.4,2.7-0.5,4.1-0.5c1.4,0,2.8,0.2,4.1,0.5c3.1-2.1,4.5-1.7,4.5-1.7
	c0.9,2.2,0.3,3.9,0.2,4.3c1,1.1,1.7,2.6,1.7,4.4c0,6.3-3.8,7.6-7.4,8c0.6,0.5,1.1,1.5,1.1,3c0,2.2,0,3.9,0,4.5
	c0,0.4,0.3,0.9,1.1,0.8c6.5-2.2,11.1-8.3,11.1-15.5C34.3,8.7,27,1.4,18,1.4z"></path>
        </svg>
      </a>
    </div>
  </header>

  <div class="mdui-drawer" id="main-drawer">
    <div class="mdui-list" mdui-collapse="{accordion: true}">
      <div class="mdui-collapse-item mdui-collapse-item-open">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue"></i>
          <div class="mdui-list-item-content">控制面板</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons"></i>
        </div>
        <div class="mdui-collapse-item-body mdui-list">
          <a href="index.html" class="mdui-list-item mdui-ripple"
            mdui-tooltip="{content: '服务端', position: 'top'}">运行状态</a>
          <a href="config.html" class="mdui-list-item mdui-ripple  mdui-list-item-active"
            mdui-tooltip="{content: '客户端', position: 'top'}">订阅配置</a>
          <a href="app.html" class="mdui-list-item mdui-ripple">软件下载</a>
          <a href="log.html" class="mdui-list-item mdui-ripple">运行日志</a>
        </div>
      </div>

    </div>
  </div>


  <div class="mdui-container">
    <p></p>
    <div class="mdui-row">
      <div class="mdui-table-fluid">
        <table class="mdui-table">
          <thead>
            <tr>
              <th>参数</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>运行状态</td>
              <td>
                <div class="mdui-row">
                  <div id="start" class="mdui-chip" hidden>
                    <span class="mdui-chip-icon mdui-color-green"><i
                        class="mdui-icon material-icons">play_arrow</i></span>
                    <span class="mdui-chip-title">运行中</span>
                  </div>
                  <div id="stop" class="mdui-chip" hidden>
                    <span class="mdui-chip-icon mdui-color-red"><i class="mdui-icon material-icons">stop</i></span>
                    <span class="mdui-chip-title">已停止</span>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td>运行控制</td>
              <td>
                <div class="mdui-row">
                  <div class="mdui-col-md-3" style="padding-left: 0">
                    <div class="mdui-chip" onclick="start_service()">
                      <span class="mdui-chip-icon mdui-color-green"><i
                          class="mdui-icon material-icons">play_arrow</i></span>
                      <span class="mdui-chip-title">启动</span>
                    </div>
                  </div>
                  <div class="mdui-col-md-3">
                    <div class="mdui-chip" onclick="stop_service()">
                      <span class="mdui-chip-icon mdui-color-red"><i class="mdui-icon material-icons">stop</i></span>
                      <span class="mdui-chip-title">停止</span>
                    </div>
                  </div>
                  <div class="mdui-col-md-3">
                    <div class="mdui-chip" onclick="restart_service()">
                      <span class="mdui-chip-icon mdui-color-yellow-700"><i
                          class="mdui-icon material-icons">settings_backup_restore</i></span>
                      <span class="mdui-chip-title">重启</span>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <tr class="vmess-config">
              <td>订阅网址</td>
              <td>
                <div class="mdui-row">
                  <div class="mdui-col-md-6">
                    <form id="subscirbe_form" action="##">
                      <input name="subscirbe_url" id="subscirbe_url" class="mdui-textfield-input" type="text"
                        value="开发中" />
                    </form>
                  </div>
                  <div class="mdui-col-md-1">
                    <button disabled onclick="update_subscirbe()" class="mdui-btn mdui-color-theme-accent mdui-ripple">
                      <i class="mdui-icon material-icons">autorenew</i>
                    </button>
                  </div>
                </div>
              </td>
            </tr>
            <tr class="vmess-config">
              <td>最近一次订阅</td>
              <td>
                <div class="mdui-row">
                  <div class="mdui-col-md-6">
                    123
                  </div>
                </div>
              </td>
            </tr>
            <tr class="vmess-config">
              <td>切换服务器节点</td>
              <td>
                <div class="mdui-row">
                  <div class="mdui-col-md-4">
                    <form id="changenode_form" action="##">
                    </form>
                  </div>
                  <div class="mdui-col-md-2"></div>
                  <div class="mdui-col-md-1">
                    <button onclick="change_node()"
                      class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-color-theme-accent mdui-ripple">切换节点</button>
                    <button onclick="test_speed()"
                      class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-color-theme-accent mdui-ripple">测速</button>
                  </div>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>
  </div>
  <p></p>

  <script src="https://cdn.jsdelivr.net/npm/js-base64@3.7.2/base64.min.js"></script>
  <script type="text/javascript">
    let nodeList = [
      'v2hk1.j.ssnss.live',
      'v2hk2.j.ssnss.live',
      'v2sg.j.ssnss.live',
      'v2us.j.ssnss.live',
      'v2jpn.j.ssnss.live',
    ]
    var change_node_form = '<select name="node" class="mdui-select" mdui-select>\n' +
      '<option id="node1" value="v2hk1.j.ssnss.live" selected> 香港高速1-J</option>\n' +
      '<option id="node2" value="v2hk2.j.ssnss.live"> 香港高速2-J </option>\n' +
      '<option id="node3" value="v2sg.j.ssnss.live"> 新加坡高速-J </option>\n' +
      '<option id="node4" value="v2us.j.ssnss.live"> 美国高速-J </option>\n' +
      '<option id="node5" value="v2jpn.j.ssnss.live"> 日本高速J </option>\n' +
      '</select>'
    $("#changenode_form").append(change_node_form)
    let index = nodeList.findIndex(val => {
      return val === data['domain']
    })
    document.getElementById('node' + (index + 1)).setAttribute('selected', 'selected');
    function getInfo() {
      $.get("/get_info", function (return_data) {
        let data = JSON.parse(return_data);
        if (data["status"] === "on") {
          document.getElementById('start').removeAttribute('hidden');
          document.getElementById('stop').setAttribute('hidden', true);
        }
        else {
          document.getElementById('stop').removeAttribute('hidden');
          document.getElementById('start').setAttribute('hidden', true);
        }
        mdui.mutation()
      });
    }
    getInfo()
    mdui.mutation();
  </script>

  <script type="text/javascript">
    function message(m_message) {
      mdui.snackbar(
        {
          message: m_message,
          position: "right-top"
        }
      )
    }
    function change_node() {
      $.get("/set_node", $('#changenode_form').serialize());
      message("节点已修改")
    }

    function update_subscirbe() {
      $.get("/set_subscirbe", $("#subscirbe_form").serialize())
      message("已更新订阅")
    }

    function test_speed() {

    }

    function change_mux(action) {
      if (action === "on") {
        $.get("/set_mux", {
          "action": "on",
        });
        message("Mux.cool 已开启")
      }
      else if (action === "off") {
        $.get("/set_mux", {
          "action": "off",
        });
        message("Mux.cool 已关闭")
      }
    }

    function start_service() {
      $.get("/start_service", function () {
        message("服务已启动")
        getInfo()
      });
    }

    function stop_service() {
      $.get("/stop_service", function () {
        message("服务已停止")
        getInfo()
      });
    }

    function restart_service() {
      $.get("/restart_service");
      message("服务已重启")
    }
  </script>
</body>


</html>